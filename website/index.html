<!DOCTYPE html lt = 19.022  72.856689>
<html lang="en" dir="ltr">

<head>
  <meta charset="utf-8">
  <title></title>

  <style>
    #map {
      height: 500px;
        margin-left: auto;
        margin-right: auto;
      width: 60%;
    }
  </style>
</head>

<script >
function main(){
  var ws =new WebSocket("ws://localhost:3000/ws1")
  var info ={} ;
  ws.onmessage = function (event) {
  console.log(event.data);
  info = JSON.parse(event.data);
  console.log(info.Lat);
  initMap(info)
  }
}


</script>

<body>

  <h1>My Google Map</h1>
  <div id="map"></div>
  <script>
    function initMap(info) {


      var options = {
        zoom: 15,
        center: {
          lat: 19.022,
          lng: 72.856689
        },
        mapTypeControlOptions: {
          style: google.maps.MapTypeControlStyle.DROPDOWN_MENU,
          mapTypeIds: ['roadmap', 'terrain', 'hybrid', 'satellite']
        },
        mapTypeControlOptions: {
          style: google.maps.MapTypeControlStyle.HORIZONTAL_BAR,
          position: google.maps.ControlPosition.TOP_CENTER
        }
    }



      // New Map
      var map = new google.maps.Map(document.getElementById('map'), options);

      //Listen for click on map
      google.maps.event.addListener(map, 'click', function(event) {


        //Add marker
        addMarker({
          coords: event.latLng
        })
      });

        var info ;
        var ws =new WebSocket("ws://localhost:3000/ws1")
        ws.onmessage = function (event) {
        console.log(event.data);
        info = JSON.parse(event.data);
        console.log(info.Lat);
        //addMarker(info)
        }



      //Recieved object by Parsing String
      //Following is JSON Object
      var myStr = {

        "loc": [{
            "content": "<h1> VJTI chi Kachra Kundi </h1>",
            "lat": info.Lat,
            "lng": info.Lng,
        //    "iconImage": './dustIcon.png'
          },
          {
            "content": "<h1> DADAR chi Kachra Kundi </h1>",
            "lat": 19.0213,
            "lng": 72.84243,
          //  "iconImage": './dustIcon.png'
          },
          {
            "content": "<h1> DOMBIVLI chi Kachra Kundi </h1>",
            "lat": 19.0213,
            "lng": 72.86243,
          //  "iconImage": './dustIcon.png'
          }
        ]
      }




    //  Add markers by gettings data from JSON object
      var m = 0 ;
      for (var m in myStr.loc) {

        var marker1 = {
          coords: {
            lat: myStr.loc[m].lat,
            lng: myStr.loc[m].lng
          },
          content: myStr.loc[m].content,
          iconImage :myStr.loc[m].iconImage
        } ;

        addMarker(marker1);
      }


      //Add marker Function

      function addMarker(props) {
        var marker = new google.maps.Marker({
          position: props.coords,
          map: map,
          animation: google.maps.Animation.DROP

        });

        //Check content
        if (props.content) {
          var infoWindow = new google.maps.InfoWindow({
            content: props.content,
          });

          marker.addListener('click', function() {
            infoWindow.open(map, marker, content);
          });
        }


        //Check for custom icon image
        if (props.iconImage) {
          //Set Icon image
          marker.setIcon(props.iconImage);
        }
      }
  }


  </script>



  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAdZHIEOVUqQznMZ-HEbUcP_euZuNNZpP8&callback=main" async defer></script>
</body>

</html>
